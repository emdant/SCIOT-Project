metadata:
  name: scan-person
  labels:
    nuclio.io/project-name: simple-tracing
spec:
  handler: "main:handler"
  runtime: nodejs
  resources: {}
  triggers:
    MqttScannerTrigger:
      class: ""
      kind: mqtt
      name: MqttScannerTrigger
      url: "192.168.0.1:1883"
      username: guest
      password: guest
      attributes:
        subscriptions:
        - topic: iot/scanners/person
          qos: 2
    default-http:
      class: ""
      kind: http
      name: default-http
      maxWorkers: 1
  build:
    functionSourceCode: Y29uc3QgeyBNb25nb0NsaWVudCB9ID0gcmVxdWlyZSgibW9uZ29kYiIpOw0KY29uc3QgdXJpID0gJ21vbmdvZGI6Ly9yb290OmV4YW1wbGVAMTkyLjE2OC4wLjE6MjcwMTcvJw0KDQpleHBvcnRzLmhhbmRsZXIgPSBmdW5jdGlvbihjb250ZXh0LCBldmVudCkgew0KICAgIHRyeSB7DQogICAgICAgIGNvbnN0IGRhdGFTdHJpbmcgPSBldmVudC5ib2R5LnRvU3RyaW5nKCk7DQogICAgICAgIGNvbnN0IHBlcnNvbkRhdGEgPSBKU09OLnBhcnNlKGRhdGFTdHJpbmcpOw0KDQogICAgICAgIGNvbnN0IGlucHV0RGF0ZSA9IG5ldyBEYXRlKHBlcnNvbkRhdGEuZGF0ZXRpbWUpOw0KICAgICAgICBwZXJzb25EYXRhLmRhdGV0aW1lID0gaW5wdXREYXRlOw0KICAgICAgICBwZXJzb25EYXRhLmZpc2NhbGNvZGUgPSBwZXJzb25EYXRhLmZpc2NhbGNvZGUudG9VcHBlckNhc2UoKTsNCg0KICAgICAgICBjb25zdCBjbGllbnQgPSBjb250ZXh0LmRiQ2xpZW50Ow0KICAgICAgICBpZiAoY2xpZW50KSB7DQogICAgICAgICAgICBjb25zdCBkYXRhYmFzZSA9IGNsaWVudC5kYigndHJhY2luZycpOw0KICAgICAgICAgICAgY29uc3QgcGVvcGxlID0gZGF0YWJhc2UuY29sbGVjdGlvbigncGVvcGxlJyk7DQoNCiAgICAgICAgICAgIHBlb3BsZS5pbnNlcnRPbmUocGVyc29uRGF0YSwge30sIChyZXN1bHQpID0+IHsNCiAgICAgICAgICAgICAgICBjb250ZXh0LmxvZ2dlci5pbmZvKGBBZGRlZCBlbnRyeSBmb3IgJHtwZXJzb25EYXRhLmZpc2NhbGNvZGV9YCk7DQogICAgICAgICAgICAgICAgY29udGV4dC5jYWxsYmFjaygnQWRkZWQgZGF0YSAnICsgZGF0YVN0cmluZyk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGNvbnRleHQubG9nZ2VyLmluZm8oJ0Nhbm5vdCB3cml0ZSB0byBkYjogdW5hYmxlIHRvIGNvbm5lY3QnKTsNCiAgICAgICAgICAgIGNvbnRleHQuY2FsbGJhY2sobmV3IGNvbnRleHQuUmVzcG9uc2UoYFNlcnZlciBlcnJvcmAsIG51bGwsICd0ZXh0L3BsYWluJywgNTAwLCAndGV4dCcpKTsNCiAgICAgICAgfQ0KDQogICAgfSBjYXRjaCAoZXJyKSB7DQogICAgICAgIGNvbnRleHQubG9nZ2VyLmVycm9yKGVycik7DQogICAgICAgIGNvbnRleHQuY2FsbGJhY2sobmV3IGNvbnRleHQuUmVzcG9uc2UoYE1hbGZvcm1lZCBpbnB1dDogJHtlcnIubWVzc2FnZX1gLCBudWxsLCAndGV4dC9wbGFpbicsIDQwMCwgJ3RleHQnKSk7DQogICAgfQ0KICAgIA0KfTsNCg0KZXhwb3J0cy5pbml0Q29udGV4dCA9IGZ1bmN0aW9uKGNvbnRleHQpIHsNCiAgICBjb25zdCBjbGllbnQgPSBuZXcgTW9uZ29DbGllbnQodXJpKTsNCiAgICBjbGllbnQuY29ubmVjdCgoZXJyLCBjbGllbnQpID0+IHsNCiAgICAgICAgaWYgKGVycikgDQogICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpOw0KICAgICAgICBlbHNlDQogICAgICAgICAgICBjb250ZXh0LmRiQ2xpZW50ID0gY2xpZW50Ow0KICAgIH0pOyAgIA0KfTs=
    baseImage: "node:lts-alpine"
    commands:
      - 'npm install mongodb'
    runtimeAttributes:
      repositories: []
    codeEntryType: sourceCode
    timestamp: 1632390359
  loggerSinks:
    - level: debug
  platform: {}
  securityContext: {}
  eventTimeout: ""
